<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
        Document
    </title>
</head>

<body>
    <input type="number" name="amount" id="amount">
    <button id="rzp-button1">
        Pay
        with
        Razorpay
    </button>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>

        document.getElementById("rzp-button1").onclick = async function (e) {
            const myHeader = new Headers();
            const amount = Number(document.getElementById('amount').value);
            console.log(amount);
            myHeader.append("Content-Type", "application/json");
            myHeader.append("Authorization", "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.IjY2NGMyNWZkNjk4NzRhMTdlNDJiOGMwOSI.yuyCGHNAaHqbEYkxIDr2IDT0KsBSQJrVd8VayxRM76c")
                const r  = await fetch("http://localhost:3000/user/createorder", {
                    method: "POST",
                    body: JSON.stringify({amount}), // 20 ruppe
                    headers: myHeader
                })
                if(r.status){
                const json = await r.json();
                // console.log(json);
                const orderDetails = json?.order;
                console.log(orderDetails);
                const {order_id, amount} = orderDetails;
                 var options ={
                key: "rzp_test_wDliOlkvtU4cdh", // Enter the Key ID generated from the Dashboard
                amount: amount.toString(), // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                currency: "INR",
                name: "Acme Corp",
                description: "Test Transaction",
                image: "https://example.com/your_logo",
                order_id: order_id,
                handler: function (response) {
                    console.log(response);
                    alert(
                        response.razorpay_payment_id
                    );
                    alert(
                        response.razorpay_order_id
                    );
                    alert(
                        response.razorpay_signature
                    );
                    const myHeaders = new Headers();
myHeaders.append("x-razorpay-signature", response.razorpay_signature);
myHeaders.append("Content-Type", "application/json");

const raw = JSON.stringify({
  "order_id": response.razorpay_payment_id,
  "payment_id": response.razorpay_order_id
});

const requestOptions = {
  method: "POST",
  headers: myHeaders,
  body: raw,
  redirect: "follow"
};

fetch("http://localhost:3000/user/verifyorder", requestOptions)
  .then((response) => response.text())
  .then((result) => console.log(result))
  .catch((error) => console.error(error));
                },
                prefill: {
                    name: "Gaurav Kumar",
                    email: "gaurav.kumar@example.com",
                    contact: "9000090000",
                },
                notes: {
                    address: "Razorpay Corporate Office",
                },
                theme: {
                    color: "#3399cc",
                },
            };  
        var rzp1 =new Razorpay(options);
        rzp1.on("payment.failed",function (response) {
            console.log(response);
                alert(response.error.code);
                alert(response.error.description);
                alert(response.error.source);
                alert(response.error.step);
                alert(response.error.reason);
                alert(response.error.metadata.order_id);
                alert(response.error.metadata.payment_id);
            }
        );
                rzp1.open();
                e.preventDefault();
            };

                }
    </script>
</body>

</html>